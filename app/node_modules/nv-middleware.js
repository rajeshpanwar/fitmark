var MongoClient = require('mongodb').MongoClient;
var nconf = require('nconf');
var mongo_url = nconf.get('mongoUrl');
var database_connection;
exports.addGlobalDb = function () {
    return function (req, res, next) {
        if(database_connection){
            req.db=database_connection;
            next();
        }else{
            MongoClient.connect(mongo_url, function (err, db) {
                database_connection = db;
                req.db = db;
                next();
            })
        }
    }
};