var hooks = require('nv-global_hooks');
var executeHooks = function (hook_name, req, res, next) {
    var split_hooks = function (hooks, next) {
        if (!hooks.length) {
            return next();
        }
        var hook = hooks.shift();
        if (hook.events.indexOf(hook_name) > -1) {
            if (!hook.handler) {
                return split_hooks(hooks, next);
            }
            hook.handler.call(module, req, res, function () {
                split_hooks(hooks, next);
            })
        } else {
            split_hooks(hooks, next);
        }
    };
    split_hooks(hooks.globalHooks, function () {
        next();
    });
};

exports.execute = function (hook_name, req, res, next) {
    executeHooks(hook_name, req, res, next);
};