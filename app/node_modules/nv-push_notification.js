var gcm = require('node-gcm');
exports.pushNotification = function (req, res, next) {
    var message = new gcm.Message();
    message.addData('message', "test");
    message.addData('title', "test");
    message.timeToLive = 3000;
    var api_key = '650089697621';
    var sender = new gcm.Sender(api_key);
    var _gcmIds = [];
    req.db.collection('nv.users').find({gcmId: {$exists: true}}, {gcmId: 1}, function (err, gcmids) {
        if (!gcmids.length) {
            return res.error(404, 'gcmIds not found');
        }
        gcmids.forEach(function (gcmId) {
            _gcmIds.push(gcmId.gcmId);
        });
        sender.send(message, _gcmIds, 4, function (err, result) {
            if (err) {
                console.error("Error is ", err);
                return res.send(406, err);
            }
            else {
                res.send(200, {data: 'Notification send'});
                console.log(result);
            }
        })
    });
};